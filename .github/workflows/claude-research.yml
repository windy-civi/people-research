name: Claude Research Test

on:
  workflow_dispatch:

jobs:
  research:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Clone openstates/people repository
      run: |
        git clone https://github.com/openstates/people.git openstates-people
    
    - name: Install Claude CLI
      run: |
        npm install -g @anthropic-ai/claude-code
        echo "Claude CLI installed, checking version..."
        claude --version || echo "Claude version check failed"
        echo "Checking if Claude CLI is in PATH..."
        which claude || echo "Claude not found in PATH"
    
    - name: Claude Hello World
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      run: |
        #!/bin/bash
        set -e
        
        
        echo "Researching Katie Britt's donors"
        
        full_prompt="Research Katie Britt, a Republican Senate legislator from Alabama.

        You have access to web search tools. Please use them to find COMPREHENSIVE and ACCURATE information about:

        DONOR INFORMATION: Search OpenSecrets.org and other campaign finance databases to find:
           - Top corporate donors with specific amounts
           - Industry breakdowns with percentages  
           - PAC and ideological donor information
           - Individual donor data where available
           - Current election cycle data (2024, 2022, etc.)

        Please provide specific source URLs for all information found."
        
        # Use Claude CLI with --print flag for non-interactive output and Haiku model
        echo "=== SENDING PROMPT TO CLAUDE 3.5 HAIKU ==="
        echo "Prompt: $full_prompt"
        echo "=== CLAUDE OUTPUT ==="
        echo "$full_prompt" | claude --print --model claude-3-5-haiku-20241022 --output-format stream-json --verbose --dangerously-skip-permissions
        echo "=== END CLAUDE OUTPUT ==="